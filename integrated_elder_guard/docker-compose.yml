version: '3.8'

services:
  # PROJECT 2: THE SOVEREIGN CLOUD (Local LLM Engine)
  # Target: UAE/Saudi Data Residency
  ollama-brain:
    image: ollama/ollama:latest
    container_name: clinical_brain_offline
    volumes:
      - ./ollama_storage:/root/.ollama
    networks:
      - sovereign_net
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:11434/api/tags" ]
      interval: 10s
      timeout: 5s

  # PROJECT 1 & 3: THE BRIDGE & LITIGATION SHIELD (FastAPI)
  # Target: US/UK Safety Compliance
  clinical-logic-api:
    build: .
    container_name: litigation_shield_api
    depends_on:
      ollama-brain:
        condition: service_healthy
    environment:
      - LOCAL_LLM_URL=http://ollama-brain:11434
      - CLINICAL_PROTOCOL=MERCK_GERIATRIC_2025
    networks:
      - sovereign_net

  # PROJECT 2: SOVEREIGN VAULT (Vector Database)
  # Target: Switzerland/South Korea Privacy
  qdrant-vault:
    image: qdrant/qdrant:latest
    container_name: clinical_vector_vault
    ports:
      - "6333:6333"
    volumes:
      - ./vault_data:/qdrant/storage
    networks:
      - sovereign_net

  # PROJECT 4: ELDER-GUARD DASHBOARD (Streamlit UI)
  # Target: Global Nursing/Triage Automation
  nurse-station:
    image: python:3.10-slim
    container_name: clinician_ui
    command: streamlit run app.py
    ports:
      - "8501:8501"
    volumes:
      - .:/app
    depends_on:
      - clinical-logic-api
    networks:
      - sovereign_net

networks:
  sovereign_net:
    driver: bridge
